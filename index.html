<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dr.MS Corpus — Viewer</title>
  <style>
    :root{--bg:#f6fbff;--card:#ffffff;--accent:#0b6df0;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:var(--bg);color:#0f1724}
    .container{max-width:980px;margin:32px auto;padding:18px}
    header{display:flex;justify-content:center;align-items:center;margin-bottom:18px}
    header h1{margin:0;font-size:28px}

    .card{background:var(--card);box-shadow:0 6px 18px rgba(12,40,80,0.06);border-radius:12px;padding:18px}

    .intro-flex{display:flex;gap:18px;align-items:flex-start}
    .logo-placeholder img{width:120px;height:120px;border-radius:8px}
    .intro-list{list-style:disc;margin:0;padding-left:18px}

    .center{display:flex;justify-content:center}
    .muted{color:var(--muted)}

    form .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text],select{padding:10px;border-radius:8px;border:1px solid #d6e4ff;min-width:220px}
    button{background:var(--accent);color:white;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:18px}
    .block{background:linear-gradient(180deg,#ffffff,#f8fdff);padding:18px;border-radius:10px;cursor:pointer;border:1px solid rgba(11,109,240,0.08)}
    .block h3{margin:0}

    .subjects{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
    .subject{padding:12px;border-radius:8px;border:1px dashed #cfe6ff;background:#fff}

    .files-wrap{display:flex;gap:12px;margin-top:12px}
    .lhs,.rhs{flex:1;background:#fff;padding:12px;border-radius:8px;border:1px solid #e6f0ff;height:70vh;overflow:auto}
    .file-item{padding:8px;border-radius:6px;margin-bottom:8px;border:1px solid #eef5ff}
    .file-item a{font-weight:600;text-decoration:none}
    .viewer{width:100%;height:100%}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    @media(max-width:720px){.subjects{grid-template-columns:repeat(2,1fr)}.files-wrap{flex-direction:column}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Dr.MS Corpus</h1>
    </header>

    <!-- INTRO PAGE -->
    <section id="intro" class="card">
      <div style="display:flex;justify-content:center;align-items:center;flex-direction:column;gap:14px">
        <div style="width:100%;display:flex;align-items:flex-start;gap:18px">
          <div class="logo-placeholder" id="logoPlaceholder" title="Logo here">
            <img src="logo.jpeg" alt="Logo">
          </div>
          <div style="flex:1">
            <ul class="intro-list">
              <li>xyzxyz</li>
              <li>xyzxyz</li>
              <li>xyzxyz</li>
            </ul>
          </div>
        </div>
        <div class="center">
          <button id="startBtn">Get Started</button>
        </div>
      </div>
    </section>

    <!-- USER DETAILS PAGE -->
    <section id="details" class="card" style="display:none;margin-top:18px">
      <h2>Visitor details</h2>
      <form id="visitorForm">
        <div class="row">
          <div>
            <label for="name">Name</label>
            <input id="name" type="text" placeholder="Your full name" required />
          </div>
          <div>
            <label for="role">Role</label>
            <select id="role">
              <option value="student">Student</option>
              <option value="teaching">Teaching professional</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <label id="yrLabel" for="yearOfStudy">Year of study</label>
            <select id="yearOfStudy">
              <option value="1st">1st yr</option>
              <option value="2nd">2nd yr</option>
              <option value="final1">Final yr part 1</option>
              <option value="final2">Final yr part 2</option>
            </select>
          </div>
          <div>
            <label for="batch">Batch (for teaching)</label>
            <input id="batch" type="text" placeholder="e.g. Batch A / 2024" />
          </div>
          <div style="flex:1;min-width:260px">
            <label for="college">Medical college</label>
            <input id="college" type="text" placeholder="Your college name" />
          </div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button type="submit">Next</button>
          <button type="button" id="toIntro">Back</button>
        </div>
      </form>
    </section>

    <!-- YEAR SELECTION -->
    <section id="yearSelect" class="card" style="display:none;margin-top:18px">
      <h2>Select year</h2>
      <div class="grid">
        <div class="block" data-year="1st"><h3>1st yr</h3><p class="muted">3 subjects</p></div>
        <div class="block" data-year="2nd"><h3>2nd yr</h3><p class="muted">3 subjects</p></div>
        <div class="block" data-year="final1"><h3>Final yr part 1</h3><p class="muted">4 subjects</p></div>
        <div class="block" data-year="final2"><h3>Final yr part 2</h3><p class="muted">9 subjects</p></div>
      </div>
      <div style="margin-top:12px">
        <button id="backToDetails">Back</button>
      </div>
    </section>

    <!-- SUBJECTS PAGE -->
    <section id="subjectsPage" class="card" style="display:none;margin-top:18px">
      <h2 id="subjectsTitle">Subjects</h2>
      <div class="subjects" id="subjectsGrid"></div>
      <div style="margin-top:12px">
        <button id="backToYears">Back</button>
      </div>
    </section>

    <!-- FILES PAGE -->
    <section id="filesPage" class="card" style="display:none;margin-top:18px">
      <h2 id="filesTitle">Files for <span id="subjectName"></span></h2>
      <div class="files-wrap">
        <div class="lhs">
          <h4>Documents / PDFs (view only)</h4>
          <div id="pdfList"></div>
        </div>
        <div class="rhs">
          <h4>PPTs (downloadable)</h4>
          <div id="pptList"></div>
        </div>
      </div>
      <div style="margin-top:12px">
        <button id="backToSubjects">Back</button>
      </div>
    </section>

    <footer class="muted">उद्धरेदात्मनात्मानं</footer>
  </div>

  <script>
    const FILES_DATA = {
  '1st': {
    'Anatomy': { pdfs:[{name:'Anatomy notes',url:'files/1st/Anatomy/pdfs/anatomy-notes.pdf'}], ppts:[{name:'Anatomy PPT',url:'files/1st/Anatomy/ppts/anatomy.pptx'}]},
    'Physiology': { pdfs:[{name:'Physiology notes',url:'files/1st/Physiology/pdfs/physio.pdf'}], ppts:[{name:'Physiology PPT',url:'files/1st/Physiology/ppts/physio.pptx'}]},
    'Biochemistry': { pdfs:[{name:'Biochemistry notes',url:'files/1st/Biochemistry/pdfs/bioch.pdf'}], ppts:[{name:'Biochemistry PPT',url:'files/1st/Biochemistry/ppts/bioch.pptx'}]}
  },
  '2nd':{
    'Pathology': { pdfs:[{name:'Pathology notes',url:'files/2nd/Pathology/pdfs/path.pdf'}], ppts:[{name:'Pathology PPT',url:'files/2nd/Pathology/ppts/path.pptx'}]},
    'Pharmacology': { pdfs:[{name:'Pharmacology notes',url:'files/2nd/Pharmacology/pdfs/pharm.pdf'}], ppts:[{name:'Pharmacology PPT',url:'files/2nd/Pharmacology/ppts/pharm.pptx'}]},
    'Microbiology': { pdfs:[{name:'Micro notes',url:'files/2nd/Microbiology/pdfs/micro.pdf'}], ppts:[{name:'Micro PPT',url:'files/2nd/Microbiology/ppts/micro.pptx'}]}
  },
  'final1':{
    'Forensic Medicine': { pdfs:[{name:'Forensic notes',url:'files/final1/Forensic Medicine/pdfs/forensic.pdf'}], ppts:[{name:'Forensic PPT',url:'files/final1/Forensic Medicine/ppts/forensic.pptx'}]},
    'Community Medicine': { pdfs:[{name:'Community notes',url:'files/final1/Community Medicine/pdfs/cm.pdf'}], ppts:[{name:'Community PPT',url:'files/final1/Community Medicine/ppts/cm.pptx'}]},
    'Ophthalmology': { pdfs:[{name:'Ophtho notes',url:'files/final1/Ophthalmology/pdfs/ophtho.pdf'}], ppts:[{name:'Ophtho PPT',url:'files/final1/Ophthalmology/ppts/ophtho.pptx'}]},
    'ENT': { pdfs:[{name:'ENT notes',url:'files/final1/ENT/pdfs/ent.pdf'}], ppts:[{name:'ENT PPT',url:'files/final1/ENT/ppts/ent.pptx'}]}
  },
  'final2':{
    'Medicine': { pdfs:[{name:'Medicine notes',url:'files/final2/Medicine/pdfs/med.pdf'}], ppts:[{name:'Medicine PPT',url:'files/final2/Medicine/ppts/med.pptx'}]},
    'Surgery': { pdfs:[{name:'Surgery notes',url:'files/final2/Surgery/pdfs/surgery.pdf'}], ppts:[{name:'Surgery PPT',url:'files/final2/Surgery/ppts/surgery.pptx'}]},
    'Obstetrics & Gynaecology': { pdfs:[{name:'OBG notes',url:'files/final2/Obstetrics & Gynaecology/pdfs/obg.pdf'}], ppts:[{name:'OBG PPT',url:'files/final2/Obstetrics & Gynaecology/ppts/obg.pptx'}]},
    'Pediatrics': { pdfs:[{name:'Pediatrics notes',url:'files/final2/Pediatrics/pdfs/pedia.pdf'}], ppts:[{name:'Pediatrics PPT',url:'files/final2/Pediatrics/ppts/pedia.pptx'}]},
    'Psychiatry': { pdfs:[{name:'Psych notes',url:'files/final2/Psychiatry/pdfs/psych.pdf'}], ppts:[{name:'Psych PPT',url:'files/final2/Psychiatry/ppts/psych.pptx'}]},
    'Dermatology': { pdfs:[{name:'Derm notes',url:'files/final2/Dermatology/pdfs/derm.pdf'}], ppts:[{name:'Derm PPT',url:'files/final2/Dermatology/ppts/derm.pptx'}]},
    'Orthopaedics': { pdfs:[{name:'Ortho notes',url:'files/final2/Orthopaedics/pdfs/ortho.pdf'}], ppts:[{name:'Ortho PPT',url:'files/final2/Orthopaedics/ppts/ortho.pptx'}]},
    'ENT': { pdfs:[{name:'ENT notes',url:'files/final2/ENT/pdfs/ent.pdf'}], ppts:[{name:'ENT PPT',url:'files/final2/ENT/ppts/ent.pptx'}]},
    'Ophthalmology': { pdfs:[{name:'Ophtho notes',url:'files/final2/Ophthalmology/pdfs/ophtho.pdf'}], ppts:[{name:'Ophtho PPT',url:'files/final2/Ophthalmology/ppts/ophtho.pptx'}]}
  }
};


    const intro = document.getElementById('intro');
    const details = document.getElementById('details');
    const yearSelect = document.getElementById('yearSelect');
    const subjectsPage = document.getElementById('subjectsPage');
    const filesPage = document.getElementById('filesPage');

    document.getElementById('startBtn').addEventListener('click',()=>{intro.style.display='none'; details.style.display='block';});
    document.getElementById('toIntro').addEventListener('click',()=>{details.style.display='none'; intro.style.display='block';});

    const form = document.getElementById('visitorForm');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = {
        name: document.getElementById('name').value||'',
        role: document.getElementById('role').value||'',
        yearOfStudy: document.getElementById('yearOfStudy').value||'',
        batch: document.getElementById('batch').value||'',
        college: document.getElementById('college').value||'',
        date: new Date().toISOString()
      };

      let logs = JSON.parse(localStorage.getItem('drms_visits')||'[]');
      logs.push(data);
      localStorage.setItem('drms_visits', JSON.stringify(logs));

      const csv = [_csvRow(Object.keys(data)), _csvRow(Object.values(data))].join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'DrMS_Corpus_visit_'+(new Date()).toISOString().slice(0,10)+'.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);

      details.style.display='none';
      yearSelect.style.display='block';
    });

    function _csvRow(arr){return arr.map(v=>('"'+String(v).replace(/"/g,'""')+'"')).join(',');}
    document.getElementById('backToDetails').addEventListener('click',()=>{yearSelect.style.display='none'; details.style.display='block';});

    document.querySelectorAll('.block').forEach(b=>{
      b.addEventListener('click',()=>{
        const year = b.getAttribute('data-year');
        showSubjects(year);
        yearSelect.style.display='none';
        subjectsPage.style.display='block';
      });
    });
    document.getElementById('backToYears').addEventListener('click',()=>{subjectsPage.style.display='none'; yearSelect.style.display='block';});

    function showSubjects(year){
      const grid = document.getElementById('subjectsGrid');
      grid.innerHTML='';
      const subjects = Object.keys(FILES_DATA[year]||{});
      document.getElementById('subjectsTitle').textContent = `Subjects — ${_prettyYear(year)}`;
      subjects.forEach(sub=>{
        const d = document.createElement('div'); d.className='subject'; d.textContent=sub;
        d.addEventListener('click',()=>{ openFilesPage(year,sub); subjectsPage.style.display='none'; filesPage.style.display='block'; });
        grid.appendChild(d);
      });
    }

    function openFilesPage(year,subject){
      document.getElementById('subjectName').textContent = subject;
      const data = (FILES_DATA[year]||{})[subject]||{pdfs:[],ppts:[]};
      const pdfList = document.getElementById('pdfList'); pdfList.innerHTML='';
      const pptList = document.getElementById('pptList'); pptList.innerHTML='';

      data.pdfs.forEach(f=>{
        const item = document.createElement('div'); item.className='file-item';
        const btn = document.createElement('button'); btn.textContent = 'View'; btn.style.marginRight='8px';
        btn.addEventListener('click', ()=>{ openViewer(f.url,f.name); });
        const span = document.createElement('span'); span.textContent = f.name;
        item.appendChild(btn); item.appendChild(span);
        pdfList.appendChild(item);
      });

      data.ppts.forEach(f=>{
        const item = document.createElement('div'); item.className='file-item';
        const a = document.createElement('a'); a.href = f.url; a.textContent = f.name; a.setAttribute('download','');
        item.appendChild(a);
        pptList.appendChild(item);
      });

      document.getElementById('backToSubjects').onclick = ()=>{filesPage.style.display='none'; subjectsPage.style.display='block';}
    }

    function openViewer(url,title){
      const w = window.open('', '_blank');
      const html = `<!doctype html><html><head>
        <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
        <title>${title}</title></head>
        <body style="margin:0;height:100%;display:flex;flex-direction:column">
          <div style="padding:8px;background:#0b6df0;color:#fff;display:flex;justify-content:space-between;align-items:center">
            <div>${title}</div>
            <div><button onclick="window.close()" style="background:#fff;border:none;padding:6px;border-radius:6px;cursor:pointer">Close</button></div>
          </div>
          <div style="flex:1">
            ${url.endsWith('.pdf') ? `<iframe src="${url}" style="width:100%;height:100%;border:none"></iframe>`
                                   : `<p style="padding:18px">Cannot preview file type. Please place a PDF to preview here.</p>`}
          </div>
        </body></html>`;
      w.document.write(html);
      w.document.close();
    }

    function _prettyYear(y){
      switch(y){
        case '1st':return '1st year';
        case '2nd':return '2nd year';
        case 'final1':return 'Final year part 1';
        case 'final2':return 'Final year part 2';
        default:return y;
      }
    }
  </script>
</body>
</html>
